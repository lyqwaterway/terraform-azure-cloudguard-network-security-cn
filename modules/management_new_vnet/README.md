# Check Point CloudGuard Management Module - New  VNet

This Terraform module deploys Check Point CloudGuard Network Security Management solution into a new  VNet in azure.
As part of the deployment the following resources are created:
- Resource group
- Virtual network
- Network security group
- Virtual Machine
- System assigned identity

This solution uses the following submodules:
- common - used for creating a resource group and defining common variables.
- VNet - used for creating new virtual network and subnets.
- network_security_group - used for creating new network security groups and rules.


## Usage
Follow best practices for using CGNS modules on [the root page](https://registry.terraform.io/modules/lyqwaterway/cloudguard-network-security-cn/azure/latest).

**Example:**
```
provider "azurerm" {
  environment = "china"
  features {}
}

module "example_module" {

    source  = "lyqwaterway/cloudguard-network-security-cn/azure//modules/management_new_vnet"
    version = "1.0.4"


    source_image_vhd_uri            = "noCustomUri"
    resource_group_name             = "checkpoint-mgmt-terraform"
    mgmt_name                       = "checkpoint-mgmt-terraform"
    location                        = "chinanorth3"
    vnet_name                       = "checkpoint-mgmt-vnet"
    address_space                   = "10.0.0.0/16"
    subnet_prefix                   = "10.0.0.0/24"
    management_GUI_client_network   = "0.0.0.0/0"
    mgmt_enable_api                 = "disable"
    admin_password                  = "xxxxxxxxxxxx"
    vm_size                         = "Standard_D3_v2"
    disk_size                       = "110"
    vm_os_sku                       = "mgmt-byol"
    vm_os_offer                     = "check-point-cg-r8110"
    os_version                      = "R8110"
    bootstrap_script                = "touch /home/admin/bootstrap.txt; echo 'hello_world' > /home/admin/bootstrap.txt"
    allow_upload_download           = true
    authentication_type             = "Password"
    admin_shell                     = "/etc/cli.sh"
    serial_console_password_hash    = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    maintenance_mode_password_hash  = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    nsg_id                          = ""
    add_storage_account_ip_rules    = false
    storage_account_additional_ips  = []
}
```



### Module's variables:
| Name                              | Description                                                                                                                                                                                                                                             | Type           | Allowed values                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **source_image_vhd_uri**          | The URI of the blob containing the development image. Please use noCustomUri if you want to use marketplace images                                                                                                                                    | string         | **Default:** "noCustomUri"                                                                                                                                                                                                                                                                                                                                                                   |
| **resource_group_name**           | The name of the resource group that will contain the contents of the deployment                                                                                                                                                                         | string         | Resource group names only allow alphanumeric characters, periods, underscores, hyphens, and parenthesis and cannot end in a period<br />                                                                                                                                                                                                                                   |
| **mgmt_name**                     | Management name                                                                                                                                                                                                                                         | string         |                                                                                                                                                                                                                                                                                                                                                                              |
| **location**                      | The region where the resources will be deployed                                                                                                                                                                                                         | string         | The full list of Azure regions can be found at https://azure.microsoft.com/regions<br />                                                                                                                                                                                                                                                                                    |
| **VNet_name**                     | The name of the virtual network that will be created                                                                                                                                                                                                   | string         | The name must begin with a letter or number, end with a letter, number, or underscore, and may contain only letters, numbers, underscores, periods, or hyphens<br />                                                                                                                                                                                                         |
| **address_space**                 | The address space that is used by a Virtual Network                                                                                                                                                                                                    | string         | A valid address in CIDR notation<br />**Default:** "10.0.0.0/16"                                                                                                                                                                                                                                                                                                                             |
| **subnet_prefix**                 | Address prefix to be used for the network subnet                                                                                                                                                                                                       | string         | A valid address in CIDR notation<br />**Default:** "10.0.0.0/24"                                                                                                                                                                                                                                                                                                                             |
| **management_GUI_client_network** | Allowed GUI clients - GUI clients network CIDR                                                                                                                                                                                                         | string         |                                                                                                                                                                                                                                                                                                                                                                              |
| **mgmt_enable_api**               | Enable API access to the management                                                                                                                                                                                                                   | string         | "all";<br />"management_only";<br />"gui_clients";<br />"disable";<br />**Default:** "disable"                                                                                                                                                                                                                                                                                               |
| **admin_password**                | The password associated with the local administrator account on each cluster member                                                                                                                                                                    | string         | Password must have 3 of the following: 1 lower case character, 1 upper case character, 1 number, and 1 special character<br />                                                                                                                                                                                                                                               |
| **vm_size**                       | Specifies the size of the Virtual Machine                                                                                                                                                                                                              | string         | A list of valid VM sizes (e.g., "Standard_DS2_v2", "Standard_DS3_v2", etc.)<br />                                                                                                                                                                                                                                                                                            |
| **disk_size**                     | Storage data disk size (GB)                                                                                                                                                                                                                           | string         | A number in the range 100 - 3995 (GB)<br />                                                                                                                                                                                                                                                                                                                                  |
| **vm_os_sku**                     | A SKU of the image to be deployed                                                                                                                                                                                                                     | string         | "mgmt-byol" - BYOL license;<br />                                                                                                                                                                                                                                                                                                                     |
| **vm_os_offer**                   | The name of the image offer to be deployed                                                                                                                                                                                                             | string         | "check-point-cg-r8110";<br />"check-point-cg-r8120";<br />"check-point-cg-r82";<br />                                                                                                                                                                                                                                                             |
| **os_version**                    | GAIA OS version                                                                                                                                                                                                                                       | string         | "R8110";<br />"R8120";<br />"R82";<br />                                                                                                                                                                                                                                                                                                                                    |
| **bootstrap_script**              | An optional script to run on the initial boot                                                                                                                                                                                                          | string         | Bootstrap script example:<br />"touch /home/admin/bootstrap.txt; echo 'hello_world' > /home/admin/bootstrap.txt"<br />**Default:** ""                                                                                                                                                                                                                                                         |
| **allow_upload_download**         | Automatically download Blade Contracts and other important data. Improve product experience by sending data to Check Point                                                                                                                            | boolean        | true;<br />false;<br />                                                                                                                                                                                                                                                                                                                                                       |
| **authentication_type**           | Specifies whether a password authentication or SSH Public Key authentication should be used                                                                                                                                                           | string         | "Password";<br />"SSH Public Key";<br />                                                                                                                                                                                                                                                                                                                                     |
| **admin_shell**                   | Enables selecting different admin shells                                                                                                                                                                                                              | string         | /etc/cli.sh;<br />/bin/bash;<br />/bin/csh;<br />/bin/tcsh;<br />**Default:** "/etc/cli.sh"                                                                                                                                                                                                                                                                                                  |
| **serial_console_password_hash**  | Optional parameter, used to enable serial console connection in case of SSH key as authentication type. To generate a password hash, use the command `openssl passwd -6 PASSWORD` on Linux and paste it here                                           | string         |                                                                                                                                                                                                                                                                                                                                                                              |
| **maintenance_mode_password_hash**| Maintenance mode password hash, relevant only for R81.20 and higher versions. To generate a password hash, use the command `grub2-mkpasswd-pbkdf2` on Linux and paste it here                                                                          | string         |                                                                                                                                                                                                                                                                                                                                                                              |
| **nsg_id**                        | Optional ID for a Network Security Group that already exists in Azure. If not provided, a default NSG will be created                                                                                                                                 | string         | Existing NSG resource ID<br />**Default:** ""                                                                                                                                                                                                                                                                                                                                               |
| **add_storage_account_ip_rules**  | Add Storage Account IP rules that allow access to the Serial Console only for IPs based on their geographic location. If false, then access will be allowed from all networks                                                                          | boolean        | true;<br />false;<br />**Default:** false                                                                                                                                                                                                                                                                                                                                                    |
| **storage_account_additional_ips**| IPs/CIDRs that are allowed access to the Storage Account                                                                                                                                                                                              | list(string)   | A list of valid IPs and CIDRs<br />**Default:** []                                                                                                                                                                                                                                                                                                                                           |
| **security_rules**                | SSecurity rules for the Network Security                                                                                                                                                                                     | list(any)      | A security rule is composed of: {name, priority, direction, access, protocol, source_port_ranges, destination_port_ranges, source_address_prefix, destination_address_prefix, description}<br />**Default:** []                                                                                                                                                                               |
| **admin_SSH_key**                 | The SSH public key for SSH connections to the instance. Used when the authentication_type is 'SSH Public Key'                                                                                                                                        | string         | **Default:** ""                          
| **is_blink**                    | Define if blink image is used for deployment | boolean      | true;<br />false;<br />**Default:** true  |